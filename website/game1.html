<!DOCTYPE html>
<html>
    <head>
        <link rel="stylesheet" type="text/css" href="styles.css"/>
        <script>
            var colours = ["red","blue","green","white","orange"];
            var tabRowNum = 2;
            var tabColNum = 2;
            var startTime;
            var intervalId;
            //
            function startTimer() {
                startTime = Date.now();
                intervalId = setInterval(function() {
                                            var elapsedTime = Date.now() - startTime;
                                            document.getElementById('timer').innerHTML = (elapsedTime / 1000).toFixed(1);
                                            }, 100);
            }
            //
            function stopTimer() {
                clearInterval(intervalId);
            }
            //
            function initFieldsDyn(rows, cols){
                var vDiv;
                var vTable;
                var vTr;
                var vTd;
                vDiv = document.createElement("div");
                vDiv.setAttribute("id", "divGame");
                vDiv.setAttribute("align", "center");
                document.body.appendChild(vDiv);
                vTable = document.createElement("table");
                vTable.setAttribute("id", "game1");
                vTable.setAttribute("onmousedown", "changeColour(event)");
                document.getElementById("divGame").appendChild(vTable);
                for(i = 1; i <= rows; i++){  
                    vTr = document.createElement("tr");
                    vTr.setAttribute("id", "row"+i);
                    document.getElementById("game1").appendChild(vTr);
                    for(j = 1; j <= cols; j++){
                        vTr = document.createElement("td");
                        vTr.setAttribute("id", "row"+i+"col"+j);
                        vTr.style.background = colours[(i+j+Math.round(Math.random()*10))%colours.length];
                        document.getElementById("row"+i).appendChild(vTr);
                    }
                }
            }
            //
            function validateResult(){
                var fisrstColor;
                var allCoulorsSame = true;
                for(i=1;i<=tabRowNum;i++){ 
                    for(j=1;j<=tabColNum;j++){
                        if(!fisrstColor){
                            fisrstColor = document.getElementById("row"+i+"col"+j).style.background;
                        }
                        if(document.getElementById("row"+i+"col"+j).style.background != fisrstColor){
                            allCoulorsSame = false;
                            break;
                        }
                    } 
                }
                if(allCoulorsSame == true){
                    stopTimer();
                    //document.getElementById("divGame").style.visibility = "hidden";
                    document.getElementById("result").style.visibility = "visible";
                } else {
                    document.getElementById("result").style.visibility = "hidden";
                }
                fisrstColor = "";
            }
            //
            function changeColour(e) {
                //get and set next colour - START
                if(!startTime){
                    startTimer();
                }
                //alert(document.getElementById(e.target.id).style.background);
                for(i=0; i<=colours.length ;i++){
                    if(colours[i] == document.getElementById(e.target.id).style.background){
                        if(i<colours.length-1){
                            document.getElementById(e.target.id).style.background = colours[i+1];
                            break;
                        } else{
                            document.getElementById(e.target.id).style.background = colours[0];
                            break;
                        }
                    }
                }
                //get and set next colour - END
                // Validate result - START
                validateResult();
                // Validate result - END
            }
        </script>
    </head>
    <body>
        <h1 id="timer">timer starts on the first click</h1>
        <script>
            initFieldsDyn(tabRowNum, tabColNum);
        </script>
        <div style="visibility: hidden;" id="result" align="center">
            <img src="img/ajax_you_did_it.jpg">
            <h1 id="output" ><a href="game1.html">PLAY AGAIN</a></h1>
        </div>
    </body>
</html>